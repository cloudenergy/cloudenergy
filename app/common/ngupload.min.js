angular.module("ngUpload",[]).directive("uploadSubmit",["$parse",function(){return{restrict:"AC",link:function(n,e){e.bind("click",function(n){if(n&&(n.preventDefault(),n.stopPropagation()),!e.attr("disabled")){var t=function n(t,e){var a=(t=angular.element(t)).parent();return e=e.toLowerCase(),a&&a[0].tagName.toLowerCase()===e?a:a?n(a,e):null}(e,"form");t.triggerHandler("submit"),t[0].submit()}})}}}]).directive("ngUpload",["$log","$parse","$document",function(f,s,a){function c(t){var e,n=a.find("head");return angular.forEach(n.find("meta"),function(n){n.getAttribute("name")===t&&(e=n)}),angular.element(e)}var m=1;return{restrict:"AC",link:function(r,e,a){function o(n){r.$isUploading=n}function i(){d.unbind("load"),r.$$phase?o(!1):r.$apply(function(){o(!1)});try{var t,e=(d[0].contentDocument||d[0].contentWindow.document).body;try{t=angular.fromJson(e.innerText||e.textContent),r.$$phase?n(r,{content:t}):r.$apply(function(){n(r,{content:t})})}catch(n){t=e.innerHTML;var a="ng-upload: Response is not valid JSON";f.warn(a),p&&(r.$$phase?p(r,{error:a}):r.$apply(function(){p(r,{error:a})}))}}catch(a){f.warn("ng-upload: Server error"),p&&(r.$$phase?p(r,{error:a}):r.$apply(function(){p(r,{error:a})}))}}m++;var l={},n=a.ngUpload?s(a.ngUpload):null,p=a.errorCatcher?s(a.errorCatcher):null,u=a.ngUploadLoading?s(a.ngUploadLoading):null;a.hasOwnProperty("uploadOptionsConvertHidden")&&(l.convertHidden="false"!=a.uploadOptionsConvertHidden),a.hasOwnProperty("uploadOptionsEnableRailsCsrf")&&(l.enableRailsCsrf="false"!=a.uploadOptionsEnableRailsCsrf),a.hasOwnProperty("uploadOptionsBeforeSubmit")&&(l.beforeSubmit=s(a.uploadOptionsBeforeSubmit)),e.attr({target:"upload-iframe-"+m,method:"post",enctype:"multipart/form-data",encoding:"multipart/form-data"});var d=angular.element('<iframe name="upload-iframe-'+m+'" border="0" width="0" height="0" style="width:0px;height:0px;border:none;display:none">');if(l.enableRailsCsrf){var t=angular.element("<input />");t.attr("class","upload-csrf-token"),t.attr("type","hidden"),t.attr("name",c("csrf-param").attr("content")),t.val(c("csrf-token").attr("content")),e.append(t)}e.after(d),o(!1),e.bind("submit",function(n){var t=r[a.name];return t&&t.$invalid?(n.preventDefault(),!1):l.beforeSubmit&&!1===l.beforeSubmit(r,{})?(r.$$phase||r.$apply(),n.preventDefault(),!1):(d.bind("load",i),l.convertHidden&&angular.forEach(e.find("input"),function(n){var t=angular.element(n);t.attr("ng-model")&&t.attr("type")&&"hidden"==t.attr("type")&&t.attr("value",r.$eval(t.attr("ng-model")))}),void(r.$$phase?(u&&u(r),o(!0)):r.$apply(function(){u&&u(r),o(!0)})))})}}}]);