angular.module("app").component("customer",{templateUrl:"app/components/customer/customer.html?rev=90e9ceabf2",bindings:{customerSelected:"="},controller:["$scope","$element","$timeout","$api","$rootScope","$stateParams","$state",function(c,e,t,r,n,o,a){var i=this;function l(e,t){for(var r=0;r<e.length;r++)e[r]==t&&(e.splice(r,1),r--);return e}function s(t,e){return i.times=0,i.customerSelected=[],4==t.parents.length?i.level=4:3==t.parents.length?i.level=3:2==t.parents.length&&(i.level=2),!i.parent1.length&&angular.forEach(i.customer.core.data,function(e){var t=e.path&&e.path.split(",").length||"";0==t&&"ROOT"!=e.id?i.parent1.push(e.id):1==t&&i.parent2.push(e.id)}),$("jstree").on("changed.jstree",function(e,r){if(!i.times)if(i.times=1,i.chosen=angular.copy(r.selected),"ROOT"===t.id){var n=[];angular.forEach(i.customer.core.data,function(e){"ROOT"===e.parent&&n.push(e.id)}),i.customerSelected=n,c.$apply()}else{if(4==i.level)angular.forEach(i.parent1,function(e){l(i.chosen,e)}),angular.forEach(i.parent2,function(e){l(i.chosen,e)}),i.customerSelected=i.chosen;else if(3==i.level){n=[];angular.forEach(i.parent2,function(t){angular.forEach(r.selected,function(e){t==e&&n.push(t)})}),n=n.distinct(),i.customerSelected=n}else if(2==i.level){n=[];angular.forEach(i.parent1,function(t){angular.forEach(r.selected,function(e){t==e&&n.push(t)})}),n=n.distinct(),i.customerSelected=n}c.$apply()}}),!0}i.choice={},i.parent1=[],i.parent2=[],Array.prototype.distinct=function(){var e,t,r=this,n=[],c=r.length;for(e=0;e<c;e++){for(t=e+1;t<c;t++)r[e]===r[t]&&(t=++e);n.push(r[e])}return n},"CUSTOMER"==o.datatype?r.customer.info({project:n.Project[0]._id},function(e){i.customer={multiple:!0,checkbox:{keep_selected_style:!1},core:{data:[{id:"ROOT",parent:"#",text:"全部",state:{opened:!0},icon:!1,checkbox:!0}],check_callback:!0},conditionalselect:s,contextmenu:{items:function(e,t){var r={};return r.create={separator_before:!1,separator_after:!0,_disabled:!1,label:"新增",action:function(e){var t=$.jstree.reference(e.reference),r=t.get_node(e.reference);console.log(e.reference),t.create_node(r,{},"last",function(e){setTimeout(function(){t.edit(e)},0)})}},"0001"!=e.id&&(r.delete={separator_before:!1,icon:!1,separator_after:!1,_disabled:!1,label:"删除",action:function(e){var t=$.jstree.reference(e.reference),r=t.get_node(e.reference);t.is_selected(r)?t.delete_node(t.get_selected()):t.delete_node(r)}},r.rename={separator_before:!1,separator_after:!1,_disabled:!1,label:"重命名",action:function(e){console.log(e);var t=$.jstree.reference(e.reference),r=t.get_node(e.reference);t.edit(r)}},r.binding={separator_before:!1,separator_after:!1,_disabled:!1,label:"绑定仪表",action:function(e){var t=$.jstree.reference(e.reference),r=t.get_node(e.reference);t.edit(r)}}),r}},plugins:["search","conditionalselect","contextmenu","checkbox","changed"]},function r(e,n){angular.forEach(e,function(e,t){e.parent=n,e.text=e.title,Object.keys(e.child).length,e.icon=!1,r(e.child,e.id),i.customer.core.data.push(e)})}(e.result,"ROOT")}):"/monitor"==a.current.url?r.customer.info({project:n.Project[0]._id},function(e){i.customer={core:{data:[{id:"ROOT",parent:"#",text:"全部",state:{opened:!0,selected:!0},icon:!1}],check_callback:!0},conditionalselect:s,contextmenu:{items:function(e,t){var r={};return r.create={separator_before:!1,separator_after:!0,_disabled:!1,label:"新增",action:function(e){var t=$.jstree.reference(e.reference),r=t.get_node(e.reference);console.log(e.reference),t.create_node(r,{},"last",function(e){setTimeout(function(){t.edit(e)},0)})}},"0001"!=e.id&&(r.delete={separator_before:!1,icon:!1,separator_after:!1,_disabled:!1,label:"删除",action:function(e){var t=$.jstree.reference(e.reference),r=t.get_node(e.reference);t.is_selected(r)?t.delete_node(t.get_selected()):t.delete_node(r)}},r.rename={separator_before:!1,separator_after:!1,_disabled:!1,label:"重命名",action:function(e){console.log(e);var t=$.jstree.reference(e.reference),r=t.get_node(e.reference);t.edit(r)}},r.binding={separator_before:!1,separator_after:!1,_disabled:!1,label:"绑定仪表",action:function(e){var t=$.jstree.reference(e.reference),r=t.get_node(e.reference);t.edit(r)}}),r}},plugins:["search","conditionalselect","contextmenu","checkbox","changed"]},function r(e,n){angular.forEach(e,function(e,t){e.parent=n,e.text=e.title,Object.keys(e.child).length,e.icon=!1,r(e.child,e.id),i.customer.core.data.push(e)})}(e.result,"ROOT")}):r.eca.info({projectid:n.Project[0]._id,type:o.datatype||"BYITEM"},function(e){i.customer={multiple:!0,checkbox:{keep_selected_style:!1},core:{data:[{id:"ROOT",parent:"#",text:"全部",state:{opened:!0},icon:!1}],check_callback:!0},conditionalselect:s,contextmenu:{items:function(e,t){var r={};return r.create={separator_before:!1,separator_after:!0,_disabled:!1,label:"新增",action:function(e){var t=$.jstree.reference(e.reference),r=t.get_node(e.reference);console.log(e.reference),t.create_node(r,{},"last",function(e){setTimeout(function(){t.edit(e)},0)})}},"0001"!=e.id&&(r.delete={separator_before:!1,icon:!1,separator_after:!1,_disabled:!1,label:"删除",action:function(e){var t=$.jstree.reference(e.reference),r=t.get_node(e.reference);t.is_selected(r)?t.delete_node(t.get_selected()):t.delete_node(r)}},r.rename={separator_before:!1,separator_after:!1,_disabled:!1,label:"重命名",action:function(e){console.log(e);var t=$.jstree.reference(e.reference),r=t.get_node(e.reference);t.edit(r)}},r.binding={separator_before:!1,separator_after:!1,_disabled:!1,label:"绑定仪表",action:function(e){var t=$.jstree.reference(e.reference),r=t.get_node(e.reference);t.edit(r)}}),r}},plugins:["search","conditionalselect","contextmenu","checkbox","changed"]},function r(e,n){angular.forEach(e,function(e,t){e.parent=n,e.text=e.title,Object.keys(e.child).length,e.icon=!1,r(e.child,e.id),i.customer.core.data.push(e)})}(e.result,"ROOT")})}]});