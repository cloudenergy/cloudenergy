angular.module("app").component("analyse",{templateUrl:"app/modules/analyse/analyse.html?rev=c0cc627fcb",controller:["$api","$scope","$rootScope","$state","$q","$stateParams","$timeout",function(n,e,l,t,i,a,o){var r,s=this,u="DAY";function m(e){var t=new Date;t.setDate(t.getDate()+e);var a=t.getFullYear(),n=t.getMonth()+1,l=t.getDate()<=9&&"0"+t.getDate()||t.getDate();return String(a)+String(n<10&&"0"+n||n)+String(l)}s.analyseTimeselected="today",("BYITEM"==a.datatype||!a.datatype)&&(s.devicedisable=!0),!s.devicedisable&&(s.energyselected=["ELECTRICITYMETER","MELECTRICITYMETER"]),console.log(s.energyselected),s.today=m(0),s.yesterday=m(-1),s.beforeyesterday=m(-2),s.beforelastMonth=String((new Date).getMonth()-1<=0?(new Date).getFullYear()-1:(new Date).getFullYear())+(1==String(Number((new Date).getMonth()+1)-2).length&&"0"+String(Number((new Date).getMonth()+1)-2)||String((new Date).getMonth()+1-2)),s.lastMonth=String(0==(new Date).getMonth()?(new Date).getFullYear()-1:(new Date).getFullYear())+(0==(new Date).getMonth()?"12":1==String((new Date).getMonth()).length&&"0"+String((new Date).getMonth())||String((new Date).getMonth())),s.thisMonth=String((new Date).getFullYear())+((new Date).getMonth()+1<10&&"0"+((new Date).getMonth()+1)||(new Date).getMonth()+1),s.year=String((new Date).getFullYear()),s.lastyear=String((new Date).getFullYear()-1),s.beforelastyear=String((new Date).getFullYear()-2),r=s.today,s.startDate=s.endDate=String((new Date).getFullYear())+"-"+((new Date).getMonth()+1<10&&"0"+((new Date).getMonth()+1)||(new Date).getMonth()+1)+"-"+(+(new Date).getDate()<=9&&"0"+(new Date).getDate()||(new Date).getDate()),s.energyselected=["ELECTRICITYMETER","MELECTRICITYMETER"],s.title="耗电量",s.unit="kwh",s.device=["ELECTRICITYMETER","MELECTRICITYMETER"],s.more=[{key:"HOTWATERMETER",title:"热水表",unit:"m3"},{key:"TEMPERATURECONTROL",title:"温控器",unit:"m3"},{key:"TTYPETEMPCONTROL",title:"T型温控器",unit:"m3"},{key:"DDWATERMETER",title:"直饮水表",unit:"m3"},{key:"ULTRACOLDWATERMETER",title:"超声波水表",unit:"m3"},{key:"PRESSUREMETER",title:"压力表",unit:"Pa"},{key:"OXYGENMETER",title:"氧气表",unit:"m3"}],s.analyseType=[{title:"分项能耗",key:"BYITEM",href:'dashboard.analyse({datatype:"BYITEM"})'},{title:"部门能耗",key:"BYAPART",href:'dashboard.analyse({datatype:"BYAPART"})'},{title:"区域能耗",key:"CUSTOMER",href:'dashboard.analyse({datatype:"CUSTOMER"})'}],s.energy=[{title:"电",key:["ELECTRICITYMETER","MELECTRICITYMETER"],unit:"kwh",name:"耗电量"},{title:"水",key:["COLDWATERMETER","HOTWATERMETER","ULTRACOLDWATERMETER"],unit:"m3",name:"用水量"},{title:"空调",key:"hotcloddata",unit:"kwh",name:"冷/热量"},{title:"费用",key:"FEE"}],s.analyseTime=[{title:"日",key:"today"},{title:"月",key:"month"},{title:"年",key:"year"}],s.analyseTypeSelected=a.datatype||"BYITEM",s.export=function(){s.gridOptions.exporterCsvFilename=document.title+"_能耗分析_"+moment().format("YYYYMMDDHHmmss")+".csv",s.gridApi.exporter.csvExport("visible","visible",angular.element(document.querySelectorAll(".subContent")))},n.eca.info({node:s.customerSelected,projectid:l.Project[0]._id,type:a.datatype||"BYITEM"},function(e){var t=e.result;s.categoryArray=[],angular.forEach(t,function(e){s.categoryArray.push(e.id)})}).$promise.then(function(){s.device=["ELECTRICITYMETER","MELECTRICITYMETER"],s.unit="kwh",s.title="耗电量",s.initialize=function(e){var t=i.defer(),a=[];return timeparams=e||"today",a.push(n.eca.analysis({nodes:s.customerSelected&&s.customerSelected||s.categoryArray,projectid:l.Project[0]._id,timefrom:r,timeto:r,devicetype:s.devicetype,detail:!0,timetype:u||"DAY"},function(e){angular.forEach(e.result,function(e){e.stack="today"}),s.cachedata=e,s.origindata=angular.copy(e)}).$promise),i.all(a).then(function(){s.getpie(["ELECTRICITYMETER","MELECTRICITYMETER"],"kwh","耗电量"),s.chartdata=s.ELECTRICITYMETER[l.type],s.unit||(s.unit="kwh"),s.chartTitle||(s.chartTitle="耗电量"),s.coldhot={},s.hotcloddata={usage:{today:{},yesterday:{},beforeyesterday:{}},cost:{today:{},yesterday:{},beforeyesterday:{}}},s.fee={today:{},yesterday:{},beforeyesterday:{}},angular.forEach(s.category,function(e){s.todaycost=new BigDecimal(String(e.todaycost)).add(new BigDecimal(String(s.todaycost||0))).setScale(2,MathContext.ROUND_HALF_UP).toString(),s.yesterdaycost=new BigDecimal(String(e.yesterdaycost)).add(new BigDecimal(String(s.yesterdaycost||0))).setScale(2,MathContext.ROUND_HALF_UP).toString(),s.beforeyesterdaycost=new BigDecimal(String(e.beforeyesterdaycost)).add(new BigDecimal(String(s.beforeyesterdaycost||0))).setScale(2,MathContext.ROUND_HALF_UP).toString(),s.coldhot.today=new BigDecimal(String(s.category.HEATENERGYMETER&&s.category.HEATENERGYMETER.today||0)).add(new BigDecimal(String(s.category.ENERGYMETER&&s.category.ENERGYMETER.today||0))).setScale(2,MathContext.ROUND_HALF_UP).toString(),s.coldhot.yesterday=new BigDecimal(String(s.category.HEATENERGYMETER&&s.category.HEATENERGYMETER.yesterday||0)).add(new BigDecimal(String(s.category.ENERGYMETER&&s.category.ENERGYMETER.yesterday||0))).setScale(2,MathContext.ROUND_HALF_UP).toString(),s.coldhot.beforeyesterday=new BigDecimal(String(s.category.HEATENERGYMETER&&s.category.HEATENERGYMETER.beforeyesterday||0)).add(new BigDecimal(String(s.category.ENERGYMETER&&s.category.ENERGYMETER.beforeyesterday||0))).setScale(2,MathContext.ROUND_HALF_UP).toString()}),angular.forEach(!angular.equals({},s.TIMERMETER.usage.today)&&s.TIMERMETER.usage||!angular.equals({},s.HEATENERGYMETER.usage.today)&&s.HEATENERGYMETER.usage||!angular.equals({},s.ENERGYMETER.usage.today)&&s.ENERGYMETER.usage,function(e,t){"beforeyesterday"==t&&angular.forEach(e,function(e,t){s.hotcloddata.usage.beforeyesterday[t]={},s.hotcloddata.usage.beforeyesterday[t].timepoint=Number(t),s.hotcloddata.usage.beforeyesterday[t].value=Number(new BigDecimal(String(!angular.equals({},s.TIMERMETER.usage.beforeyesterday)&&s.TIMERMETER.usage.beforeyesterday[t].value||0)).add(new BigDecimal(String(!angular.equals({},s.HEATENERGYMETER.usage.beforeyesterday)&&s.HEATENERGYMETER.usage.beforeyesterday[t].value||0))).add(new BigDecimal(String(!angular.equals({},s.ENERGYMETER.usage.beforeyesterday)&&s.ENERGYMETER.usage.beforeyesterday[t].value||0))).setScale(2,MathContext.ROUND_HALF_UP).toString())})}),angular.forEach(s,function(e){angular.equals({},e.cost)||angular.forEach(e.cost,function(e,t){"today"==t&&angular.forEach(e,function(e,t){!s.fee.today[t]&&(s.fee.today[t]={}),s.fee.today[t].timepoint=Number(t),s.fee.today[t].value=Number(new BigDecimal(String(s.fee.today[t].value||0)).add(new BigDecimal(String(e.cost))).toString())}),"yesterday"==t&&angular.forEach(e,function(e,t){!s.fee.yesterday[t]&&(s.fee.yesterday[t]={}),s.fee.yesterday[t].timepoint=Number(t),s.fee.yesterday[t].value=Number(new BigDecimal(String(s.fee.yesterday[t].value||0)).add(new BigDecimal(String(e.cost))).toString())}),"beforeyesterday"==t&&angular.forEach(e,function(e,t){!s.fee.beforeyesterday[t]&&(s.fee.beforeyesterday[t]={}),s.fee.beforeyesterday[t].timepoint=Number(t),s.fee.beforeyesterday[t].value=Number(new BigDecimal(String(s.fee.beforeyesterday[t].value||0)).add(new BigDecimal(String(e.cost))).toString())})})}),("DAY"==u||angular.isUndefined(u))&&(l.tips={todayELECTRICITYMETER:s.category.ELECTRICITYMETER.today,yesterdayELECTRICITYMETER:s.category.ELECTRICITYMETER.yesterday,beforeyesterdayELECTRICITYMETER:s.category.ELECTRICITYMETER.beforeyesterday,todayCOLDWATERMETER:s.category.COLDWATERMETER.today,yesterdayCOLDWATERMETER:s.category.COLDWATERMETER.yesterday,beforeyesterdayCOLDWATERMETER:s.category.COLDWATERMETER.beforeyesterday,todaycoldhot:s.coldhot.today,yesterdaycoldhot:s.coldhot.today.yesterday,beforeyesterdaycoldhot:s.coldhot.today.beforeyesterday,todaycost:s.todaycost,yesterdaycost:s.yesterdaycost,beforeyesterdaycost:s.beforeyesterdaycost})}),t.resolve(),t.promise},e.$watch("$ctrl.customerSelected",function(e){s.device=void 0,s.unit=void 0,s.getdevicedata()})}),s.lastMonthdata=function(){n.eca.analysis({nodes:s.customerSelected&&s.customerSelected||s.categoryArray,projectid:l.Project[0]._id,timefrom:String(0==(new Date).getMonth()?(new Date).getFullYear()-1:(new Date).getFullYear())+(0==(new Date).getMonth()?"12":1==String((new Date).getMonth()).length&&"0"+String((new Date).getMonth())||String((new Date).getMonth()))+String((new Date).getDate()<10&&"0"+String((new Date).getDate())||(new Date).getDate()),timeto:String(0==(new Date).getMonth()?(new Date).getFullYear()-1:(new Date).getFullYear())+(0==(new Date).getMonth()?"12":1==String((new Date).getMonth()).length&&"0"+String((new Date).getMonth())||String((new Date).getMonth()))+String((new Date).getDate()<10&&"0"+String((new Date).getDate())||(new Date).getDate()),devicetype:s.devicetype,detail:!0,timetype:u||"DAY"},function(e){s.datacopy=s.origindata.result,angular.forEach(e.result,function(e){e.stack="lastmouth",e.title=e.title+"(上月同期)",s.datacopy.push(e)}),s.cachedata.result=s.datacopy})},s.lastYeardata=function(){n.eca.analysis({nodes:s.customerSelected&&s.customerSelected||s.categoryArray,projectid:l.Project[0]._id,timefrom:String((new Date).getFullYear())-1+((new Date).getMonth()+1<10&&"0"+((new Date).getMonth()+1)||(new Date).getMonth()+1)+String((new Date).getDate()<10&&"0"+String((new Date).getDate())||(new Date).getDate()),timeto:String((new Date).getFullYear())-1+((new Date).getMonth()+1<10&&"0"+((new Date).getMonth()+1)||(new Date).getMonth()+1)+String((new Date).getDate()<10&&"0"+String((new Date).getDate())||(new Date).getDate()),devicetype:s.devicetype,detail:!0,timetype:u||"DAY"},function(e){s.datacopy=s.origindata.result,angular.forEach(e.result,function(e){e.stack="lastmouth",e.title=e.title+"(去年同期)",s.datacopy.push(e)}),s.cachedata.result=s.datacopy})},s.gridOptions={onRegisterApi:function(e){s.gridApi=e},rowHeight:34,infiniteScrollDown:!0,enableColumnMenus:!1,enableColumnResizing:!0,exporterOlderExcelCompatibility:!0,exporterFieldCallback:function(e,t,a,n){return{name:!0,addr:!0,title:!0,time:!0}[a.field]?'="'+(n||"")+'"':n}},s.columnDefsData=function(){s.gridOptions.rowHeight=45,"DAY"==u?s.gridOptions.columnDefs=[{displayName:"类别",name:"name",type:"string",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5",cellTemplate:'<div class="ui-grid-cell-contents"><span ng-bind="row.entity.name"></span>(kwh)</div>'},{displayName:"00:00",name:"hour0",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"01:00",name:"hour1",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"02:00",name:"hour2",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"03:00",name:"hour3",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"04:00",name:"hour4",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"05:00",name:"hour5",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"06:00",name:"hour6",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"07:00",name:"hour7",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"08:00",name:"hour8",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"09:00",name:"hour9",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"10:00",name:"hour10",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"11:00",name:"hour11",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"12:00",name:"hour12",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"13:00",name:"hour13",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"14:00",name:"hour14",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"15:00",name:"hour15",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"16:00",name:"hour16",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"17:00",name:"hour17",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"18:00",name:"hour18",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"19:00",name:"hour19",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"20:00",name:"hour20",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"21:00",name:"hour21",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"22:00",name:"hour22",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"23:00",name:"hour23",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"}]:"MONTH"==u?s.gridOptions.columnDefs=[{displayName:"类别",name:"name",type:"string",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5",cellTemplate:'<div class="ui-grid-cell-contents"><span ng-bind="row.entity.name"></span>(kwh)</div>'},{displayName:"01",name:"hour0",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"02",name:"hour1",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"03",name:"hour2",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"04",name:"hour3",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"05",name:"hour4",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"06",name:"hour5",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"07",name:"hour6",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"08",name:"hour8",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"09",name:"hour9",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"10",name:"hour10",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"11",name:"hour11",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"12",name:"hour12",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"13",name:"hour13",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"14",name:"hour14",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"15",name:"hour15",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"16",name:"hour16",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"17",name:"hour17",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"18",name:"hour18",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"19",name:"hour19",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"20",name:"hour20",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"21",name:"hour21",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"22",name:"hour22",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"23",name:"hour23",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"24",name:"hour24",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"25",name:"hour25",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"26",name:"hour26",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"27",name:"hour27",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"28",name:"hour28",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"29",name:"hour29",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"30",name:"hour30",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"31",name:"hour31",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"}]:"YEAR"==u&&(s.gridOptions.columnDefs=[{displayName:"类别",name:"name",type:"string",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5",cellTemplate:'<div class="ui-grid-cell-contents"><span ng-bind="row.entity.name"></span>(kwh)</div>'},{displayName:"2018",name:"hour0",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"2019",name:"hour1",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"2020",name:"hour2",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"2021",name:"hour3",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"2022",name:"hour4",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"2023",name:"hour5",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"2024",name:"hour6",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"2025",name:"hour7",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"2026",name:"hour8",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"2027",name:"hour9",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"2028",name:"hour10",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"2029",name:"hour11",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"}])},s.getpie=function(e,t,a){s.piedata={},s.gridOptions.data=[],s.pieunit={title:a||s.title,unit:t||s.unit},s.device&&angular.forEach(s.cachedata.result,function(e){var t={},a=0;t.name=e.title,!e.data||null!=!e.data.usage&&angular.equals({},e.data.usage)||(angular.forEach(e.data.usage,function(e){t["hour"+a]=angular.isDefined(e.value)&&e.value||"0",a++}),s.gridOptions.data.push(t),s.piedata[e.title]=e.data&&e.data.usagesum||0)}),x=0,!s.device&&angular.forEach(s.cachedata.result,function(e){var t={},a=0;t.name=e.title,!e.data||null!=!e.data.cost&&angular.equals({},e.data.cost)||(x++,angular.forEach(e.data.cost,function(e){t["hour"+a]=angular.isDefined(e.cost)&&e.cost||"0",a++}),s.gridOptions.data.push(t),s.piedata[e.title]=e.data&&(e.data.costsum||0)||0)}),s.columnDefsData()},s.getdevicedata=function(e,t,a){s.energyselected=e||["ELECTRICITYMETER","MELECTRICITYMETER"],"FEE"!==e&&"hotcloddata"!==e&&(s.devicetype=e),s.device=e||["ELECTRICITYMETER","MELECTRICITYMETER"],"FEE"!==s.energyselected?(s.unit=t||"kwh",s.title=a||"耗电量",s.chartTitle=a||"耗电量"):(s.unit="元",s.title="费用",s.chartTitle=" 费用"),"hotcloddata"===e&&(s.device=["TIMERMETER","HEATENERGYMETER","ENERGYMETER"],s.devicetype=["TIMERMETER","HEATENERGYMETER","ENERGYMETER"]),"FEE"!==s.energyselected&&s.initialize(s.analyseTimeselected).finally(function(){s.chartdata=s[e][l.type],"hotcloddata"===e?s.getpie(["TIMERMETER","HEATENERGYMETER","ENERGYMETER"],t,a):s.getpie(s.device,s.unit,s.title)}),console.log(s.energyselected)},s.getfeedata=function(){s.switch="cost",s.unit="元",s.device=void 0,s.title=s.chartTitle="费用",s.getpie(void 0,"元","总费用")},s.redata=function(){s.ELECTRICITYMETER={},s.COLDWATERMETER={},s.HOTWATERMETER={},s.HEATENERGYMETER={},s.TEMPERATURECONTROL={},s.TIMERMETER={},s.PRESSUREMETER={},s.ULTRACOLDWATERMETER={},s.DDWATERMETER={},s.ENERGYMETER={},s.TTYPETEMPCONTROL={},s.OXYGENMETER={},s.category={}},s.customdate=function(){s.redata(),"MONTH"==u?(r=s.startDate.split("-")[0]+s.startDate.split("-")[1],s.endDate.split("-")[0]+s.endDate.split("-")[1]):"YEAR"==u?(r=s.startDate.split("-")[0],s.endDate.split("-")[0]):(r=s.startDate.split("-")[0]+s.startDate.split("-")[1]+s.startDate.split("-")[2],s.endDate.split("-")[0]+s.endDate.split("-")[1]+s.endDate.split("-")[2]),s.getdevicedata(s.device,s.unit,s.title)},s.gettimedata=function(e){s.same=s.circle=!1,"today"==(s.analyseTimeselected=e)?(s.redata(),r=s.today,s.beforeyesterday,u="DAY"):"month"==e?(s.redata(),r=s.thisMonth,s.beforelastMonth,u="MONTH"):"year"==e&&(s.redata(),r=s.year,s.beforelastyear,u="YEAR"),s.getdevicedata(s.device,s.unit,s.title)}}]}),angular.module("app").component("ele",{templateUrl:"app/modules/analyse/ele.html?rev=2d191893df",bindings:{cost:"=",data:"<",unit:"=",timetype:"<",chartTitle:"<"},controller:["$scope","$rootScope","$api","$timeout",function(e,t,a,n){var i=this;e.$watch(function(){return i.cost},function(){var l=[];i.series=[],i.unit="元",i.data&&angular.forEach(i.data.result,function(t,e,a){if(t.data&&!angular.equals(t.data.cost,{})){var n={name:"",data:[],stack:""};n.stack=t.stack,angular.forEach(t.data.cost,function(e){n.name=t.title,l.push(e.timepoint),n.data.push(e.cost)}),i.series.push(n),l=l.unique1()}angular.forEach(["#24CBE5","#FF9655","#6AF9C4","#64E572","#FFE556","#FF987B","#FF5690","#EB31AC","#EF76D0","#ECABF3","#9F7BF6","#8650EB","#90B2FF"],function(e,t){i.series[t]&&(i.series[t].color=e)})}),i.cost=void 0,i.typeChange=function(e){e&&(i.charttype=e),i.energyconstitute={chart:{type:i.charttype,height:"520",backgroundColor:"rgba(0, 0, 0, 0)"},title:!1,xAxis:{type:"datetime",categories:l,labels:{formatter:function(){return"today"==i.timetype?moment(this.value).format("HH:ss"):"month"==i.timetype?moment(this.value).format("M-DD"):"year"==i.timetype?moment(this.value).format("YYYY-MM"):void 0},style:{color:"#000"}}},yAxis:{title:!1,labels:{style:{color:"#000"}}},tooltip:{xDateFormat:"%m月%d日",pointFormat:'{series.name}: <span style="color:black;font-weight:700;">{point.y} '+i.unit+"</span>"},plotOptions:{column:{stacking:"normal",dataLabels:{enabled:!0,style:{color:"#000"}}}},legend:{itemStyle:{color:"#000"},maxHeight:40,navigation:{activeColor:"#3E576F",animation:!0,arrowSize:12,inactiveColor:"#CCC",style:{float:"right",fontWeight:"bold",color:"#333",fontSize:"12px"}}},series:i.series,exporting:{enabled:!1}}},i.typeChange()}),e.$watchCollection(function(){return i.data},function(e){var l=[];i.series=[],i.charttype="column",i.timetype=i.timetype||(i.timetype="today"),Array.prototype.unique1=function(){for(var e=[this[0]],t=1;t<this.length;t++){for(var a=!1,n=0;n<e.length;n++)if(this[t]==e[n]){a=!0;break}a||e.push(this[t])}return e},i.data&&angular.forEach(i.data.result,function(t,e,a){if(t.data&&!angular.equals(t.data.usage,{})){var n={name:"",data:[],stack:""};n.stack=t.stack,angular.forEach(t.data.usage,function(e){n.name=t.title,l.push(e.timepoint),n.data.push(e.value)}),i.series.push(n),l=l.unique1()}angular.forEach(["#24CBE5","#FF9655","#6AF9C4","#64E572","#FFE556","#FF987B","#FF5690","#EB31AC","#EF76D0","#ECABF3","#9F7BF6","#8650EB","#90B2FF"],function(e,t){i.series[t]&&(i.series[t].color=e)})}),i.typeChange()})}]}),angular.module("app").component("pie",{templateUrl:"app/modules/analyse/pie.html?rev=2f73e52508",bindings:{data:"<",unit:"<",chartTitle:"<"},controller:["$scope","$rootScope","$api","$timeout",function(e,t,a,n){var l=this;e.$watchCollection(function(){return l.data},function(){data=l.data||{};var a=0;l.unit||(l.unit={title:"总耗电量",unit:"kwh"}),angular.forEach(data,function(e,t){this.push([t,e]),a=Number(new BigDecimal(String(a)).add(new BigDecimal(String(e))).toString())},data=[]),l.dailysensordetail={chart:{style:{textAlign:"left"},height:"520",backgroundColor:"rgba(0, 0, 0, 0)",type:"pie"},title:{text:'<div class="pieTitle">'+l.unit.title+'</div><div style="color:#000">'+a+"</div>",verticalAlign:"middle",useHTML:!0,y:-45},tooltip:{pointFormat:"<b>{point.y:.2f}</b>"},plotOptions:{pie:{dataLabels:!1,innerSize:"80%",showInLegend:!0,size:"80%"}},legend:{itemStyle:{color:"#000",fontSize:"12px"},labelFormatter:function(){var e=Math.round(10*this.percentage)/10+"% "+this.name,t=Math.round(100*(this.y||0))/100;return['<span class="center-block" title="'+e+'">'+e+"</span>",'<span class="center-block text-muted" title="'+t+'">'+t+"</span>"].join("")},maxHeight:40,useHTML:!0,navigation:{activeColor:"#3E576F",animation:!0,arrowSize:12,inactiveColor:"#CCC",style:{fontWeight:"bold",color:"#333",fontSize:"12px",align:"right",x:"200",marginLeft:"20"}}},series:[{cropThreshold:0,turboThreshold:0,innerSize:"60%",data:data,colors:["#24CBE5","#FF9655","#FFF263","#6AF9C4","#64E572"]}],exporting:{enabled:!1}}})}]});