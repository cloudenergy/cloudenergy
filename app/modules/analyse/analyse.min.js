angular.module("app").component("analyse",{templateUrl:"app/modules/analyse/analyse.html?rev=0dd9ee2428",controller:["$api","$scope","$rootScope","$state","$q","$stateParams","$timeout",function(n,e,l,t,i,a,r){var o,u=this,s="DAY";function d(e){var t=new Date;t.setDate(t.getDate()+e);var a=t.getFullYear(),n=t.getMonth()+1,l=t.getDate()<=9&&"0"+t.getDate()||t.getDate();return String(a)+String(n<10&&"0"+n||n)+String(l)}u.analyseTimeselected="today",u.isHide=!0,("BYITEM"==a.datatype||!a.datatype)&&(u.devicedisable=!0),!u.devicedisable&&(u.energyselected=["ELECTRICITYMETER","MELECTRICITYMETER"]),u.today=d(0),u.yesterday=d(-1),u.beforeyesterday=d(-2),u.beforelastMonth=String((new Date).getMonth()-1<=0?(new Date).getFullYear()-1:(new Date).getFullYear())+(1==String(Number((new Date).getMonth()+1)-2).length&&"0"+String(Number((new Date).getMonth()+1)-2)||String((new Date).getMonth()+1-2)),u.lastMonth=String(0==(new Date).getMonth()?(new Date).getFullYear()-1:(new Date).getFullYear())+(0==(new Date).getMonth()?"12":1==String((new Date).getMonth()).length&&"0"+String((new Date).getMonth())||String((new Date).getMonth())),u.thisMonth=String((new Date).getFullYear())+((new Date).getMonth()+1<10&&"0"+((new Date).getMonth()+1)||(new Date).getMonth()+1),u.year=String((new Date).getFullYear()),u.lastyear=String((new Date).getFullYear()-1),u.beforelastyear=String((new Date).getFullYear()-2),o=u.today,u.startDate=u.endDate=String((new Date).getFullYear())+"-"+((new Date).getMonth()+1<10&&"0"+((new Date).getMonth()+1)||(new Date).getMonth()+1)+"-"+(+(new Date).getDate()<=9&&"0"+(new Date).getDate()||(new Date).getDate()),u.energyselected=["ELECTRICITYMETER","MELECTRICITYMETER"],u.title="耗电量",u.unit="kwh",u.device=["ELECTRICITYMETER","MELECTRICITYMETER"],u.more=[{key:"HOTWATERMETER",title:"热水表",unit:"m3"},{key:"TEMPERATURECONTROL",title:"温控器",unit:"m3"},{key:"TTYPETEMPCONTROL",title:"T型温控器",unit:"m3"},{key:"DDWATERMETER",title:"直饮水表",unit:"m3"},{key:"ULTRACOLDWATERMETER",title:"超声波水表",unit:"m3"},{key:"PRESSUREMETER",title:"压力表",unit:"Pa"},{key:"OXYGENMETER",title:"氧气表",unit:"m3"}],u.analyseType=[{title:"分项能耗",key:"BYITEM",href:'dashboard.analyse({datatype:"BYITEM"})'},{title:"部门能耗",key:"BYAPART",href:'dashboard.analyse({datatype:"BYAPART"})'},{title:"区域能耗",key:"CUSTOMER",href:'dashboard.analyse({datatype:"CUSTOMER"})'}],u.energy=[{title:"电",key:["ELECTRICITYMETER","MELECTRICITYMETER"],unit:"kwh",name:"耗电量"},{title:"水",key:["COLDWATERMETER","HOTWATERMETER","ULTRACOLDWATERMETER"],unit:"m3",name:"用水量"},{title:"空调",key:"hotcloddata",unit:"kwh",name:"冷/热量"},{title:"费用",key:"FEE"}],u.analyseTime=[{title:"日",key:"today"},{title:"月",key:"month"},{title:"年",key:"year"}],u.analyseTypeSelected=a.datatype||"BYITEM",u.export=function(){u.gridOptions.exporterCsvFilename=document.title+"_能耗分析_"+moment().format("YYYYMMDDHHmmss")+".csv",u.gridApi.exporter.csvExport("visible","visible",angular.element(document.querySelectorAll(".subContent")))},n.eca.info({node:u.customerSelected,projectid:l.Project[0]._id,type:a.datatype||"BYITEM"},function(e){var t=e.result;u.treeData=e.result,u.categoryArray=[],angular.forEach(t,function(e){u.categoryArray.push(e.id)})}).$promise.then(function(){u.device=["ELECTRICITYMETER","MELECTRICITYMETER"],u.unit="kwh",u.title="耗电量",u.initialize=function(e){var t=i.defer(),a=[];return timeparams=e||"today",a.push(n.eca.analysis({nodes:u.customerSelected&&u.customerSelected||u.categoryArray,projectid:l.Project[0]._id,timefrom:o,timeto:o,devicetype:u.devicetype,detail:!0,timetype:s||"DAY"},function(e){angular.forEach(e.result,function(e){e.stack="today"}),u.cachedata=e,u.origindata=angular.copy(e)}).$promise),i.all(a).then(function(){u.getpie(["ELECTRICITYMETER","MELECTRICITYMETER"],"kwh","耗电量"),u.chartdata=u.ELECTRICITYMETER[l.type],u.unit||(u.unit="kwh"),u.chartTitle||(u.chartTitle="耗电量"),u.coldhot={},u.hotcloddata={usage:{today:{},yesterday:{},beforeyesterday:{}},cost:{today:{},yesterday:{},beforeyesterday:{}}},u.fee={today:{},yesterday:{},beforeyesterday:{}},angular.forEach(u.category,function(e){u.todaycost=new BigDecimal(String(e.todaycost)).add(new BigDecimal(String(u.todaycost||0))).setScale(2,MathContext.ROUND_HALF_UP).toString(),u.yesterdaycost=new BigDecimal(String(e.yesterdaycost)).add(new BigDecimal(String(u.yesterdaycost||0))).setScale(2,MathContext.ROUND_HALF_UP).toString(),u.beforeyesterdaycost=new BigDecimal(String(e.beforeyesterdaycost)).add(new BigDecimal(String(u.beforeyesterdaycost||0))).setScale(2,MathContext.ROUND_HALF_UP).toString(),u.coldhot.today=new BigDecimal(String(u.category.HEATENERGYMETER&&u.category.HEATENERGYMETER.today||0)).add(new BigDecimal(String(u.category.ENERGYMETER&&u.category.ENERGYMETER.today||0))).setScale(2,MathContext.ROUND_HALF_UP).toString(),u.coldhot.yesterday=new BigDecimal(String(u.category.HEATENERGYMETER&&u.category.HEATENERGYMETER.yesterday||0)).add(new BigDecimal(String(u.category.ENERGYMETER&&u.category.ENERGYMETER.yesterday||0))).setScale(2,MathContext.ROUND_HALF_UP).toString(),u.coldhot.beforeyesterday=new BigDecimal(String(u.category.HEATENERGYMETER&&u.category.HEATENERGYMETER.beforeyesterday||0)).add(new BigDecimal(String(u.category.ENERGYMETER&&u.category.ENERGYMETER.beforeyesterday||0))).setScale(2,MathContext.ROUND_HALF_UP).toString()}),angular.forEach(!angular.equals({},u.TIMERMETER.usage.today)&&u.TIMERMETER.usage||!angular.equals({},u.HEATENERGYMETER.usage.today)&&u.HEATENERGYMETER.usage||!angular.equals({},u.ENERGYMETER.usage.today)&&u.ENERGYMETER.usage,function(e,t){"beforeyesterday"==t&&angular.forEach(e,function(e,t){u.hotcloddata.usage.beforeyesterday[t]={},u.hotcloddata.usage.beforeyesterday[t].timepoint=Number(t),u.hotcloddata.usage.beforeyesterday[t].value=Number(new BigDecimal(String(!angular.equals({},u.TIMERMETER.usage.beforeyesterday)&&u.TIMERMETER.usage.beforeyesterday[t].value||0)).add(new BigDecimal(String(!angular.equals({},u.HEATENERGYMETER.usage.beforeyesterday)&&u.HEATENERGYMETER.usage.beforeyesterday[t].value||0))).add(new BigDecimal(String(!angular.equals({},u.ENERGYMETER.usage.beforeyesterday)&&u.ENERGYMETER.usage.beforeyesterday[t].value||0))).setScale(2,MathContext.ROUND_HALF_UP).toString())})}),angular.forEach(u,function(e){angular.equals({},e.cost)||angular.forEach(e.cost,function(e,t){"today"==t&&angular.forEach(e,function(e,t){!u.fee.today[t]&&(u.fee.today[t]={}),u.fee.today[t].timepoint=Number(t),u.fee.today[t].value=Number(new BigDecimal(String(u.fee.today[t].value||0)).add(new BigDecimal(String(e.cost))).toString())}),"yesterday"==t&&angular.forEach(e,function(e,t){!u.fee.yesterday[t]&&(u.fee.yesterday[t]={}),u.fee.yesterday[t].timepoint=Number(t),u.fee.yesterday[t].value=Number(new BigDecimal(String(u.fee.yesterday[t].value||0)).add(new BigDecimal(String(e.cost))).toString())}),"beforeyesterday"==t&&angular.forEach(e,function(e,t){!u.fee.beforeyesterday[t]&&(u.fee.beforeyesterday[t]={}),u.fee.beforeyesterday[t].timepoint=Number(t),u.fee.beforeyesterday[t].value=Number(new BigDecimal(String(u.fee.beforeyesterday[t].value||0)).add(new BigDecimal(String(e.cost))).toString())})})}),("DAY"==s||angular.isUndefined(s))&&(l.tips={todayELECTRICITYMETER:u.category.ELECTRICITYMETER.today,yesterdayELECTRICITYMETER:u.category.ELECTRICITYMETER.yesterday,beforeyesterdayELECTRICITYMETER:u.category.ELECTRICITYMETER.beforeyesterday,todayCOLDWATERMETER:u.category.COLDWATERMETER.today,yesterdayCOLDWATERMETER:u.category.COLDWATERMETER.yesterday,beforeyesterdayCOLDWATERMETER:u.category.COLDWATERMETER.beforeyesterday,todaycoldhot:u.coldhot.today,yesterdaycoldhot:u.coldhot.today.yesterday,beforeyesterdaycoldhot:u.coldhot.today.beforeyesterday,todaycost:u.todaycost,yesterdaycost:u.yesterdaycost,beforeyesterdaycost:u.beforeyesterdaycost})}),t.resolve(),t.promise},e.$watch("$ctrl.customerSelected",function(e){u.device=void 0,u.unit=void 0,u.getdevicedata()})}),u.lastMonthdata=function(){n.eca.analysis({nodes:u.customerSelected&&u.customerSelected||u.categoryArray,projectid:l.Project[0]._id,timefrom:String(0==(new Date).getMonth()?(new Date).getFullYear()-1:(new Date).getFullYear())+(0==(new Date).getMonth()?"12":1==String((new Date).getMonth()).length&&"0"+String((new Date).getMonth())||String((new Date).getMonth()))+String((new Date).getDate()<10&&"0"+String((new Date).getDate())||(new Date).getDate()),timeto:String(0==(new Date).getMonth()?(new Date).getFullYear()-1:(new Date).getFullYear())+(0==(new Date).getMonth()?"12":1==String((new Date).getMonth()).length&&"0"+String((new Date).getMonth())||String((new Date).getMonth()))+String((new Date).getDate()<10&&"0"+String((new Date).getDate())||(new Date).getDate()),devicetype:u.devicetype,detail:!0,timetype:s||"DAY"},function(e){u.datacopy=u.origindata.result,angular.forEach(e.result,function(e){e.stack="lastmouth",e.title=e.title+"(上月同期)",u.datacopy.push(e)}),u.cachedata.result=u.datacopy})},u.lastYeardata=function(){n.eca.analysis({nodes:u.customerSelected&&u.customerSelected||u.categoryArray,projectid:l.Project[0]._id,timefrom:String((new Date).getFullYear())-1+((new Date).getMonth()+1<10&&"0"+((new Date).getMonth()+1)||(new Date).getMonth()+1)+String((new Date).getDate()<10&&"0"+String((new Date).getDate())||(new Date).getDate()),timeto:String((new Date).getFullYear())-1+((new Date).getMonth()+1<10&&"0"+((new Date).getMonth()+1)||(new Date).getMonth()+1)+String((new Date).getDate()<10&&"0"+String((new Date).getDate())||(new Date).getDate()),devicetype:u.devicetype,detail:!0,timetype:s||"DAY"},function(e){u.datacopy=u.origindata.result,angular.forEach(e.result,function(e){e.stack="lastmouth",e.title=e.title+"(去年同期)",u.datacopy.push(e)}),u.cachedata.result=u.datacopy})},u.gridOptions={onRegisterApi:function(e){u.gridApi=e},rowHeight:34,infiniteScrollDown:!0,enableColumnMenus:!1,enableColumnResizing:!0,exporterOlderExcelCompatibility:!0,exporterFieldCallback:function(e,t,a,n){return{name:!0,addr:!0,title:!0,time:!0}[a.field]?'="'+(n||"")+'"':n}},u.columnDefsData=function(){u.gridOptions.rowHeight=45,"DAY"==s?u.gridOptions.columnDefs=[{displayName:"类别",name:"name",type:"string",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5",cellTemplate:'<div class="ui-grid-cell-contents"><span ng-bind="row.entity.name"></span>(kwh)</div>'},{displayName:"00:00",name:"hour0",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"01:00",name:"hour1",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"02:00",name:"hour2",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"03:00",name:"hour3",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"04:00",name:"hour4",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"05:00",name:"hour5",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"06:00",name:"hour6",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"07:00",name:"hour7",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"08:00",name:"hour8",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"09:00",name:"hour9",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"10:00",name:"hour10",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"11:00",name:"hour11",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"12:00",name:"hour12",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"13:00",name:"hour13",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"14:00",name:"hour14",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"15:00",name:"hour15",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"16:00",name:"hour16",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"17:00",name:"hour17",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"18:00",name:"hour18",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"19:00",name:"hour19",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"20:00",name:"hour20",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"21:00",name:"hour21",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"22:00",name:"hour22",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"23:00",name:"hour23",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"}]:"MONTH"==s?u.gridOptions.columnDefs=[{displayName:"类别",name:"name",type:"string",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5",cellTemplate:'<div class="ui-grid-cell-contents"><span ng-bind="row.entity.name"></span>(kwh)</div>'},{displayName:"01",name:"hour0",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"02",name:"hour1",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"03",name:"hour2",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"04",name:"hour3",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"05",name:"hour4",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"06",name:"hour5",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"07",name:"hour6",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"08",name:"hour8",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"09",name:"hour9",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"10",name:"hour10",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"11",name:"hour11",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"12",name:"hour12",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"13",name:"hour13",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"14",name:"hour14",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"15",name:"hour15",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"16",name:"hour16",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"17",name:"hour17",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"18",name:"hour18",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"19",name:"hour19",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"20",name:"hour20",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"21",name:"hour21",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"22",name:"hour22",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"23",name:"hour23",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"24",name:"hour24",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"25",name:"hour25",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"26",name:"hour26",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"27",name:"hour27",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"28",name:"hour28",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"29",name:"hour29",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"30",name:"hour30",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"31",name:"hour31",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"}]:"YEAR"==s&&(u.gridOptions.columnDefs=[{displayName:"类别",name:"name",type:"string",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5",cellTemplate:'<div class="ui-grid-cell-contents"><span ng-bind="row.entity.name"></span>(kwh)</div>'},{displayName:"2018",name:"hour0",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"2019",name:"hour1",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"2020",name:"hour2",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"2021",name:"hour3",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"2022",name:"hour4",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"2023",name:"hour5",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"2024",name:"hour6",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"2025",name:"hour7",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"2026",name:"hour8",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"2027",name:"hour9",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"2028",name:"hour10",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"},{displayName:"2029",name:"hour11",type:"number",minWidth:120,enableColumnMenu:!0,enableSorting:!0,cellClass:"pt5"}])},u.getpie=function(e,t,a){u.piedata={},u.gridOptions.data=[],u.pieunit={title:a||u.title,unit:t||u.unit},u.device&&angular.forEach(u.cachedata.result,function(e){var t={},a=0;t.name=e.title,!e.data||null!=!e.data.usage&&angular.equals({},e.data.usage)||(angular.forEach(e.data.usage,function(e){t["hour"+a]=angular.isDefined(e.value)&&e.value||"0",a++}),u.gridOptions.data.push(t),u.piedata[e.title]=e.data&&e.data.usagesum||0)}),x=0,!u.device&&angular.forEach(u.cachedata.result,function(e){var t={},a=0;t.name=e.title,!e.data||null!=!e.data.cost&&angular.equals({},e.data.cost)||(x++,angular.forEach(e.data.cost,function(e){t["hour"+a]=angular.isDefined(e.cost)&&e.cost||"0",a++}),u.gridOptions.data.push(t),u.piedata[e.title]=e.data&&(e.data.costsum||0)||0)}),u.columnDefsData()},u.getdevicedata=function(e,t,a){u.energyselected=e||["ELECTRICITYMETER","MELECTRICITYMETER"],"FEE"!==e&&"hotcloddata"!==e&&(u.devicetype=e),u.device=e||["ELECTRICITYMETER","MELECTRICITYMETER"],"FEE"!==u.energyselected?(u.unit=t||"kwh",u.title=a||"耗电量",u.chartTitle=a||"耗电量"):(u.unit="元",u.title="费用",u.chartTitle=" 费用"),"hotcloddata"===e&&(u.device=["TIMERMETER","HEATENERGYMETER","ENERGYMETER"],u.devicetype=["TIMERMETER","HEATENERGYMETER","ENERGYMETER"]),"FEE"!==u.energyselected&&u.initialize(u.analyseTimeselected).finally(function(){u.chartdata=u[e][l.type],"hotcloddata"===e?u.getpie(["TIMERMETER","HEATENERGYMETER","ENERGYMETER"],t,a):u.getpie(u.device,u.unit,u.title)})},u.getfeedata=function(){u.switch="cost",u.unit="元",u.device=void 0,u.title=u.chartTitle="费用",u.getpie(void 0,"元","总费用")},u.redata=function(){u.ELECTRICITYMETER={},u.COLDWATERMETER={},u.HOTWATERMETER={},u.HEATENERGYMETER={},u.TEMPERATURECONTROL={},u.TIMERMETER={},u.PRESSUREMETER={},u.ULTRACOLDWATERMETER={},u.DDWATERMETER={},u.ENERGYMETER={},u.TTYPETEMPCONTROL={},u.OXYGENMETER={},u.category={}},u.customdate=function(){u.redata(),"MONTH"==s?(o=u.startDate.split("-")[0]+u.startDate.split("-")[1],u.endDate.split("-")[0]+u.endDate.split("-")[1]):"YEAR"==s?(o=u.startDate.split("-")[0],u.endDate.split("-")[0]):(o=u.startDate.split("-")[0]+u.startDate.split("-")[1]+u.startDate.split("-")[2],u.endDate.split("-")[0]+u.endDate.split("-")[1]+u.endDate.split("-")[2]),u.getdevicedata(u.device,u.unit,u.title)},u.gettimedata=function(e){u.same=u.circle=!1,"today"==(u.analyseTimeselected=e)?(u.redata(),o=u.today,u.beforeyesterday,s="DAY"):"month"==e?(u.redata(),o=u.thisMonth,u.beforelastMonth,s="MONTH"):"year"==e&&(u.redata(),o=u.year,u.beforelastyear,s="YEAR"),u.getdevicedata(u.device,u.unit,u.title)}}]}),angular.module("app").component("ele",{templateUrl:"app/modules/analyse/ele.html?rev=2d191893df",bindings:{cost:"=",data:"<",unit:"=",timetype:"<",chartTitle:"<"},controller:["$scope","$rootScope","$api","$timeout",function(e,t,a,n){var i=this;e.$watch(function(){return i.cost},function(){var l=[];i.series=[],i.unit="元",i.data&&angular.forEach(i.data.result,function(t,e,a){if(t.data&&!angular.equals(t.data.cost,{})){var n={name:"",data:[],stack:""};n.stack=t.stack,angular.forEach(t.data.cost,function(e){n.name=t.title,l.push(e.timepoint),n.data.push(e.cost)}),i.series.push(n),l=l.unique1()}angular.forEach(["#24CBE5","#FF9655","#6AF9C4","#64E572","#FFE556","#FF987B","#FF5690","#EB31AC","#EF76D0","#ECABF3","#9F7BF6","#8650EB","#90B2FF"],function(e,t){i.series[t]&&(i.series[t].color=e)})}),i.cost=void 0,i.typeChange=function(e){e&&(i.charttype=e),i.energyconstitute={chart:{type:i.charttype,height:"520",backgroundColor:"rgba(0, 0, 0, 0)"},title:!1,xAxis:{type:"datetime",categories:l,labels:{formatter:function(){return"today"==i.timetype?moment(this.value).format("HH:ss"):"month"==i.timetype?moment(this.value).format("M-DD"):"year"==i.timetype?moment(this.value).format("YYYY-MM"):void 0},style:{color:"#000"}}},yAxis:{title:!1,labels:{style:{color:"#000"}}},tooltip:{xDateFormat:"%m月%d日",pointFormat:'{series.name}: <span style="color:black;font-weight:700;">{point.y} '+i.unit+"</span>"},plotOptions:{column:{stacking:"normal",dataLabels:{enabled:!0,style:{color:"#000"}}}},legend:{itemStyle:{color:"#000"},maxHeight:40,navigation:{activeColor:"#3E576F",animation:!0,arrowSize:12,inactiveColor:"#CCC",style:{float:"right",fontWeight:"bold",color:"#333",fontSize:"12px"}}},series:i.series,exporting:{enabled:!1}}},i.typeChange()}),e.$watchCollection(function(){return i.data},function(e){var l=[];i.series=[],i.charttype="column",i.timetype=i.timetype||(i.timetype="today"),Array.prototype.unique1=function(){for(var e=[this[0]],t=1;t<this.length;t++){for(var a=!1,n=0;n<e.length;n++)if(this[t]==e[n]){a=!0;break}a||e.push(this[t])}return e},i.data&&angular.forEach(i.data.result,function(t,e,a){if(t.data&&!angular.equals(t.data.usage,{})){var n={name:"",data:[],stack:""};n.stack=t.stack,angular.forEach(t.data.usage,function(e){n.name=t.title,l.push(e.timepoint),n.data.push(e.value)}),i.series.push(n),l=l.unique1()}angular.forEach(["#24CBE5","#FF9655","#6AF9C4","#64E572","#FFE556","#FF987B","#FF5690","#EB31AC","#EF76D0","#ECABF3","#9F7BF6","#8650EB","#90B2FF"],function(e,t){i.series[t]&&(i.series[t].color=e)})}),i.typeChange()})}]}),angular.module("app").component("pie",{templateUrl:"app/modules/analyse/pie.html?rev=2f73e52508",bindings:{data:"<",unit:"<",chartTitle:"<"},controller:["$scope","$rootScope","$api","$timeout",function(e,t,a,n){var l=this;e.$watchCollection(function(){return l.data},function(){data=l.data||{};var a=0;l.unit||(l.unit={title:"总耗电量",unit:"kwh"}),angular.forEach(data,function(e,t){this.push([t,e]),a=Number(new BigDecimal(String(a)).add(new BigDecimal(String(e))).toString())},data=[]),l.dailysensordetail={chart:{style:{textAlign:"left"},height:"520",backgroundColor:"rgba(0, 0, 0, 0)",type:"pie"},title:{text:'<div class="pieTitle">'+l.unit.title+'</div><div style="color:#000">'+a+"</div>",verticalAlign:"middle",useHTML:!0,y:-45},tooltip:{pointFormat:"<b>{point.y:.2f}</b>"},plotOptions:{pie:{dataLabels:!1,innerSize:"80%",showInLegend:!0,size:"80%"}},legend:{itemStyle:{color:"#000",fontSize:"12px"},labelFormatter:function(){var e=Math.round(10*this.percentage)/10+"% "+this.name,t=Math.round(100*(this.y||0))/100;return['<span class="center-block" title="'+e+'">'+e+"</span>",'<span class="center-block text-muted" title="'+t+'">'+t+"</span>"].join("")},maxHeight:40,useHTML:!0,navigation:{activeColor:"#3E576F",animation:!0,arrowSize:12,inactiveColor:"#CCC",style:{fontWeight:"bold",color:"#333",fontSize:"12px",align:"right",x:"200",marginLeft:"20"}}},series:[{cropThreshold:0,turboThreshold:0,innerSize:"60%",data:data,colors:["#24CBE5","#FF9655","#FFF263","#6AF9C4","#64E572"]}],exporting:{enabled:!1}}})}]}),angular.module("app").component("tree",{templateUrl:"app/modules/analyse/tree.html?rev=80880b1162",bindings:{data:"<",inputChecked:"=",unit:"<",chartTitle:"<"},controller:["$api","$scope","$rootScope","$state","$q","$stateParams","$timeout","$element",function(e,t,a,n,l,i,r,o){var u=this,s=a.Project[0]._id;u.tree=[];var d=document.getElementsByClassName("treeInputAll"),m=document.getElementsByClassName("treeInput2"),c=document.getElementsByClassName("treeInput3"),p=document.getElementsByClassName("treeInput4");u.inputChecked=[],u.treeInputDisabled=function(e){switch(e){case"treeInputAll":break;case"treeInput2":for(var t=0;t<m.length;t++){if(m[t].checked){u.treeInput2Checked=!0;break}u.treeInput2Checked=!1}break;case"treeInput3":for(t=0;t<c.length;t++){if(c[t].checked){u.treeInput2Checked=!0,u.treeInput3Checked=!0;break}u.treeInput3Checked=!1}break;case"treeInput4":for(t=0;t<p.length;t++){if(p[t].checked){u.treeInput2Checked=!0,u.treeInput3Checked=!0,u.treeInput4Checked=!0;break}u.treeInput4Checked=!1}}},u.checkedPush=function(e,t){switch(u.inputChecked=[],e){case"treeInputAll":d.checked&&(u.inputChecked=[]);break;case"treeInput2":for(var a=0;a<m.length;a++)m[a].checked&&u.inputChecked.push(m[a].value);break;case"treeInput3":for(a=0;a<c.length;a++)c[a].checked&&u.inputChecked.push(c[a].value);break;case"treeInput4":for(a=0;a<p.length;a++)p[a].checked&&u.inputChecked.push(p[a].value)}},u.sensor=function(){$("#sensor").modal("show")},u.clickAdd=function(e){u.treeAddEacTit="",u.treeAddEacType="BYITEM",u.treeAddEacKey="",u.treeAddEacFormula="",u.treeAddEacEnable=!0,u.treeAddParent=e.parent,u.treeAddName=e.title,$("#addModal").modal("show")},u.addEca=function(){e.eca.update({projectid:s,method:"ADD",node:{title:u.treeAddEacTit,type:i.datatype||"BYITEM",enable:!0,parent:u.treeAddParent}},function(e){u.dataUp(),$("#addModal").modal("hide")})},u.clickUpData=function(e){u.treeUpDataEacKey=e.key,u.treeUpDataEacOldTit=e.title,u.treeUpDataEacTit=e.title,u.treeUpDataEacType=e.type,u.treeUpDataEacFormula=e.formula,u.treeUpDataEacEnable=e.enable,u.treeUpDataEacId=e.id,$("#upDataModal").modal("show")},u.upDataEca=function(){e.eca.update({projectid:s,method:"UPDATE",node:{key:u.treeUpDataEacKey,title:u.treeUpDataEacTit,type:u.treeUpDataEacType,formula:u.treeUpDataEacFormula,enable:u.treeUpDataEacEnable,id:u.treeUpDataEacId}},function(e){u.dataUp(),$("#upDataModal").modal("hide")})},u.clickRemove=function(e){u.treeRemoveEacKey=e.key,u.treeRemoveEacTit=e.title,u.treeRemoveEacType=e.type,u.treeRemoveEacFormula=e.formula,u.treeRemoveEacEnable=e.enable,u.treeRemoveEacId=e.id,$("#removeModal").modal("show")},u.removeEca=function(){e.eca.update({projectid:s,method:"REMOVE",node:{key:u.treeRemoveEacKey,title:u.treeRemoveEacTit,type:u.treeRemoveEacType,formula:u.treeRemoveEacFormula,enable:u.treeRemoveEacEnable,id:u.treeRemoveEacId}},function(e){u.dataUp(),$("#removeModal").modal("hide")})},u.dataUp=function(){e.eca.info({projectid:a.Project[0]._id,type:i.datatype||"BYITEM"},function(e){u.data=e.result})},t.menuClose=function(){t.divShow=!1,t.childDivShow2=!1,t.childDivShow3=!1,t.childDivShow4=!1},u.clickBinding=function(e){u.treeSensor=e,$("#sensor").modal("show")},t.$watch("treeData",function(){u.dataUp()})}]});