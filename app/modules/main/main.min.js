angular.module("app").component("main",{templateUrl:"app/modules/main/main.html?rev=84773db766",controller:["$api","$q","$timeout","$interval","$state","$scope","$rootScope",function(o,t,e,a,i,r,n){var l=this;function s(t){var e=new Date;e.setDate(e.getDate()+t);var a=e.getFullYear(),o=e.getMonth()+1,i=e.getDate()<=9&&"0"+e.getDate()||e.getDate();return String(a)+String(o<10&&"0"+o||o)+String(i)}timeout=e(function t(){l.timeStr=moment().format("HH:mm:ss"),l.hour=l.timeStr.split(":")[0],l.minute=l.timeStr.split(":")[1],l.second=l.timeStr.split(":")[2],timeout=e(t,1e3)}),l.Day="星期"+"日一二三四五六".charAt((new Date).getDay()),l.todayDate=(new Date).getFullYear()+"-"+((new Date).getMonth()+1)+"-"+(new Date).getDate();var c=["#24CBE5","#FF9655","#6AF9C4","#64E572","#FFE556","#FF987B","#FF5690","#EB31AC","#EF76D0","#ECABF3","#9F7BF6","#8650EB","#90B2FF"];l.lastMonth=String(0==(new Date).getMonth()?(new Date).getFullYear()-1:(new Date).getFullYear())+(0==(new Date).getMonth()?"12":1==String((new Date).getMonth()).length&&"0"+String((new Date).getMonth())||String((new Date).getMonth())),l.thisMonth=String((new Date).getFullYear())+((new Date).getMonth()+1<10&&"0"+((new Date).getMonth()+1)||(new Date).getMonth()+1),l.lastthisMonth=String((new Date).getFullYear()-1)+((new Date).getMonth()+1<10&&"0"+((new Date).getMonth()+1)||(new Date).getMonth()+1),l.this={},l.last={},o.business.monthlykgce({time:l.thisMonth,project:n.Project[0]._id},function(t){t=t.result[n.Project[0]._id],l.kwhperunitarea=t.kwhperunitarea,l.kgce=t.kgce,l.kgceperunitarea=t.kgceperunitarea,o.business.monthlykgce({time:l.lastMonth,project:n.Project[0]._id},function(t){t=t.result[n.Project[0]._id],l.this.kwhperunitarea=t.kwhperunitarea,l.this.kgce=t.kgce,l.this.kgceperunitarea=t.kgceperunitarea,l.this.kwhperunitareaP=((l.kwhperunitarea-l.this.kwhperunitarea)/(l.this.kwhperunitarea||1)*100).toFixed(2),l.this.kgceP=((l.kgce-l.this.kgce)/(l.this.kgce||1)*100).toFixed(2),l.this.kgceperunitareaP=((l.kgceperunitarea-l.this.kgceperunitarea)/(l.this.kgceperunitarea||1)*100).toFixed(2),o.business.monthlykgce({time:l.lastthisMonth,project:n.Project[0]._id},function(t){t=t.result[n.Project[0]._id],l.last.kwhperunitarea=t.kwhperunitarea,l.last.kgce=t.kgce,l.last.kgceperunitarea=t.kgceperunitarea,l.last.kwhperunitareaP=((l.kwhperunitarea-l.this.kwhperunitarea)/(l.this.kwhperunitarea||1)*100).toFixed(2),l.last.kgceP=((l.kgce-l.this.kgce)/(l.this.kgce||1)*100).toFixed(2),l.last.kgceperunitareaP=((l.kgceperunitarea-l.this.kgceperunitarea)/(l.this.kgceperunitarea||1)*100).toFixed(2),console.log(l.this,l.last)})})}),o.business.monthlycost({time:l.thisMonth,project:n.Project[0]._id},function(t){l.cost=t.result[n.Project[0]._id].cost,o.business.monthlycost({time:l.lastMonth,project:n.Project[0]._id},function(t){l.this.cost=t.result[n.Project[0]._id].cost,l.this.costP=((l.cost-l.this.cost)/(l.this.cost||1)*100).toFixed(2),o.business.monthlycost({time:l.lastthisMonth,project:n.Project[0]._id},function(t){l.last.cost=t.result[n.Project[0]._id].cost,l.last.costP=((l.cost-l.last.cost)/(l.last.cost||1)*100).toFixed(2)})})}),o.business.monitor({project:n.Project[0]._id,showexception:!0,devicetype:"ELECTRICITYMETER"},function(t){l.ELECTRICITYMETER_BRO=t.result[n.Project[0]._id].paging.count}),o.business.monitor({project:n.Project[0]._id,showexception:!1,devicetype:"ELECTRICITYMETER"},function(t){l.ELECTRICITYMETER=t.result[n.Project[0]._id].paging.count}),o.business.monitor({project:n.Project[0]._id,showexception:!0,devicetype:"COLDWATERMETER"},function(t){l.COLDWATERMETER_BRO=t.result[n.Project[0]._id].paging.count}),o.business.monitor({project:n.Project[0]._id,showexception:!1,devicetype:"COLDWATERMETER"},function(t){l.COLDWATERMETER=t.result[n.Project[0]._id].paging.count}),o.business.monitor({project:n.Project[0]._id,showexception:!0,devicetype:"MELECTRICITYMETER"},function(t){l.MELECTRICITYMETER_BRO=t.result[n.Project[0]._id].paging.count}),o.business.monitor({project:n.Project[0]._id,showexception:!1,devicetype:"MELECTRICITYMETER"},function(t){l.MELECTRICITYMETER=t.result[n.Project[0]._id].paging.count}),o.collector.info({project:n.Project[0]._id},function(t){t=t.result,l.collector=t.paging.count[0].count}),o.eca.info({projectid:n.Project[0]._id},function(t){var e=[];angular.forEach(t.result,function(t){e.push(t.id)}),o.eca.analysis({nodes:e,projectid:n.Project[0]._id,timefrom:s(0),timeto:s(0),devicetype:["ELECTRICITYMETER","MELECTRICITYMETER"],timetype:"DAY",detail:!0},function(t){l.eledata={timepoint:[],value:[]};var o={};t=t.result,angular.forEach(t,function(t){angular.forEach(t.data.usage,function(t){var e,a;console.log(t),l.eledata.timepoint.push((e=t.timepoint,a=new Date(parseInt(e)).getHours(),a+="时")),console.log(l.eledata.timepoint),!o[t.timepoint]&&(o[t.timepoint]=t.value)||(o[t.timepoint]=o[t.timepoint]+t.value)})}),angular.forEach(o,function(t){l.eledata.value.push(t||0)}),l.linedata={tooltip:{trigger:"axis",axisPointer:{type:"cross",label:{backgroundColor:"#6a7985"}}},legend:{textStyle:{color:"#fff"}},grid:{top:10,bottom:"4%",left:"3%",right:10,containLabel:!0},xAxis:[{type:"category",boundaryGap:!1,data:l.eledata&&l.eledata.timepoint||l.waterdata&&l.waterdata.timepoint,splitLine:{show:!1},axisLine:{lineStyle:{color:"rgba(255,255,255,0.6)"}},labels:{formatter:function(){return moment(this.value).format({DAY:"H",WEEK:"M-DD",MONTH:"M-DD",YEAR:"YYYY-MM"}[self.timetype_current])}}}],yAxis:[{type:"value",splitLine:{show:!1},axisLine:{lineStyle:{color:"rgba(255,255,255,0.6)"}}}],textStyle:{color:"#fff"},series:[{name:"电",type:"line",stack:"总量",areaStyle:{normal:{}},smooth:!0,symbol:"circle",symbolSize:5,sampling:"average",itemStyle:{normal:{color:"#d68262"}},areaStyle:{normal:{color:new echarts.graphic.LinearGradient(0,0,0,1.4,[{offset:0,color:"#d68262"},{offset:1,color:"rgba(0,0,0,0)"}])}},data:l.eledata&&l.eledata.value},{name:"水",type:"line",stack:"总量",areaStyle:{normal:{}},smooth:!0,symbol:"circle",symbolSize:5,sampling:"average",itemStyle:{normal:{color:"#8ec6ad"}},areaStyle:{normal:{color:new echarts.graphic.LinearGradient(0,0,0,1.4,[{offset:0,color:"#8ec6ad"},{offset:1,color:"rgba(0,0,0,0)"}])}},data:l.waterdata&&l.waterdata.value}]}}),o.eca.analysis({nodes:e,projectid:n.Project[0]._id,timefrom:s(0),timeto:s(0),devicetype:"COLDWATERMETER",timetype:"DAY",detail:!0},function(t){l.waterdata={timepoint:[],value:[]};var e={};t=t.result,angular.forEach(t,function(t){angular.forEach(t.data.usage,function(t){l.waterdata.timepoint.push(t.timepoint),!e[t.timepoint]&&(e[t.timepoint]=t.value)||(e[t.timepoint]=e[t.timepoint]+t.value)})}),angular.forEach(e,function(t){l.waterdata.value.push(t)}),l.linedata={tooltip:{trigger:"axis",axisPointer:{type:"cross",label:{backgroundColor:"#6a7985"}}},legend:{textStyle:{color:"#fff"}},grid:{top:10,bottom:"4%",left:"3%",right:10,containLabel:!0},xAxis:[{type:"category",boundaryGap:!1,data:l.eledata&&l.eledata.timepoint||l.waterdata&&l.waterdata.timepoint,splitLine:{show:!1},axisLine:{lineStyle:{color:"rgba(255,255,255,0.6)"}},labels:{formatter:function(){return moment(this.value).format("H")}}}],yAxis:[{type:"value",splitLine:{show:!1},axisLine:{lineStyle:{color:"rgba(255,255,255,0.6)"}}}],textStyle:{color:"#fff"},series:[{name:"电",type:"line",stack:"总量",areaStyle:{normal:{}},smooth:!0,symbol:"circle",symbolSize:5,sampling:"average",itemStyle:{normal:{color:"#d68262"}},areaStyle:{normal:{color:new echarts.graphic.LinearGradient(0,0,0,1.4,[{offset:0,color:"#d68262"},{offset:1,color:"rgba(0,0,0,0)"}])}},data:l.eledata&&l.eledata.value},{name:"水",type:"line",stack:"总量",areaStyle:{normal:{}},smooth:!0,symbol:"circle",symbolSize:5,sampling:"average",itemStyle:{normal:{color:"#8ec6ad"}},areaStyle:{normal:{color:new echarts.graphic.LinearGradient(0,0,0,1.4,[{offset:0,color:"#8ec6ad"},{offset:1,color:"rgba(0,0,0,0)"}])}},data:l.waterdata&&l.waterdata.value}]}})}),o.business.projectYearKGCE({projectid:n.Project[0]._id}),r.baseConfig={dataLoaded:!0},r.baseConfigRandar={dataLoaded:!0},r.baseConfigTurn={dataLoaded:!0},r.barConfig=angular.copy(r.baseConfig),r.barOption={xAxis:{type:"category",data:["01","02","03","04","05","06","07","08","09","10","11","12"],axisLine:{lineStyle:{color:"#fff"}}},yAxis:{type:"value",show:!1},grid:{top:0,bottom:40,left:0,right:0,containLabel:!0},series:[{data:[120,200,150,80,70,110,130,12,23,200,30,130],type:"bar",itemStyle:{normal:{color:"#FF6400"}}}]},r.barConfig2=angular.copy(r.baseConfig),r.barOption2={xAxis:{type:"category",data:["01","02","03","04","05","06","07","08","09","10","11","12"],axisLine:{lineStyle:{color:"#fff"}}},yAxis:{type:"value",show:!1},grid:{top:0,bottom:40,left:0,right:0,containLabel:!0},series:[{data:[120,200,150,80,70,110,130,12,23,200,30,130],type:"bar",itemStyle:{normal:{color:"#58EDCC"}}}]},r.barConfig3=angular.copy(r.baseConfig),r.barOption3={xAxis:{type:"category",data:["01","02","03","04","05","06","07","08","09","10","11","12"],axisLine:{lineStyle:{color:"#fff"}}},yAxis:{type:"value",show:!1},grid:{top:0,bottom:40,left:0,right:0,containLabel:!0},series:[{data:[120,200,150,80,70,110,130,12,23,200,30,130],type:"bar",itemStyle:{normal:{color:"#F4D140"}}}]},l.itemPie=function(a){o.eca.info({type:"BYITEM",projectid:n.Project[0]._id},function(t){var e=[];angular.forEach(t.result,function(t){e.push(t.id)}),o.eca.analysis({nodes:e,projectid:n.Project[0]._id,timefrom:s(0),timeto:s(0),timetype:a||"DAY",detail:!1},function(t){var e=[];angular.forEach(t.result,function(t){e.push({value:t.data.kgcesum,name:t.title})}),r.barOptionRandar={tooltip:{trigger:"item",formatter:"{a} <br/>{b} : {c} ({d}%)"},series:[{name:"能耗分项",type:"pie",radius:["50%","70%"],data:e,itemStyle:{emphasis:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}},color:c}]}})})},l.itemPie(),l.categoryPie=function(a){o.eca.info({type:"BYCATEGORY",projectid:n.Project[0]._id},function(t){var e=[];angular.forEach(t.result,function(t){e.push(t.id)}),o.eca.analysis({nodes:e,projectid:n.Project[0]._id,timefrom:s(0),timeto:s(0),timetype:a||"DAY",detail:!1},function(t){var e=[];angular.forEach(t.result,function(t){e.push({value:t.data.kgcesum,name:t.title})}),r.barOptionPie={tooltip:{trigger:"item",formatter:"{a} <br/>{b} : {c} ({d}%)"},series:[{name:"能耗分类",type:"pie",radius:["50%","70%"],data:e,itemStyle:{emphasis:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}},color:c}]}})})},l.categoryPie(),console.log(n),l.custom=function(){o.eca.info({projectid:n.Project[0]._id,type:"CUSTOMER"},function(t){var e=t.result;l.categoryArray=[],angular.forEach(e,function(t){l.categoryArray.push(t.id)})}).$promise.then(function(){o.eca.analysis({nodes:l.categoryArray,projectid:n.Project[0]._id,timefrom:String((new Date).getFullYear()),timeto:String((new Date).getFullYear()),detail:!1,timetype:"YEAR"},function(t){var a;l.data=t.result,angular.forEach(l.data,function(t){t.kgcesum=t.data&&t.data.kgcesum||0}),l.data=l.data.sort((a="kgcesum",function(t,e){return t[a]-e[a]})),l.data=l.data.slice(-5),l.yname=[],l.series=[],angular.forEach(l.data,function(t){l.yname.push(t.title),l.series.push(t.data&&t.data.kgcesum||0)}),l.max=l.data[l.data.length-1].data.kgcesum,console.log(l.max,l.data,111),r.barOptionTurn={tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},grid:{top:10,left:"3%",right:"4%",bottom:"3%",containLabel:!0,y:0,y2:0},xAxis:{type:"value",boundaryGap:[0,.01],axisLine:{lineStyle:{color:"rgba(255,255,255,0)"}},splitLine:{show:!1},max:l.max},yAxis:[{type:"category",axisLabel:{interval:0},axisLine:{lineStyle:{color:"rgba(255,255,255,0)"}},data:l.yname,splitLine:{show:!1}},{type:"category",axisLine:{show:!1},axisTick:{show:!1},axisLabel:{show:!1},splitArea:{show:!1},splitLine:{show:!1},data:l.yname}],textStyle:{color:"#fff"},series:[{type:"bar",data:l.series,itemStyle:{normal:{color:"#E9603B"}}},{name:"",type:"bar",yAxisIndex:1,itemStyle:{normal:{color:"rgba(200, 200, 200,0.1)"}},data:[l.max,l.max,l.max,l.max,l.max]}]}})})},l.custom(),r.lineConfigBottom=angular.copy(r.baseConfig),r.lineOptionBottom={title:{},tooltip:{trigger:"axis"},grid:{top:20,left:"3%",right:"4%",bottom:10,containLabel:!0},xAxis:{type:"category",boundaryGap:!1,data:["一月","二月","三月","四月","五月","六月","七月"],splitLine:{show:!1},axisLine:{lineStyle:{color:"rgba(255,255,255,0.6)"}}},yAxis:{type:"value",splitLine:{show:!1},axisLine:{lineStyle:{color:"rgba(255,255,255,0.6)"}}},textStyle:{color:"#fff"},series:[{name:"去年走势",type:"line",stack:"总量",data:[120,132,101,134,90,230,210]},{name:"今年走势",type:"line",stack:"总量",data:[220,182,191,234,290,330,310]}]}}]}),angular.module("app").component("line",{templateUrl:"app/modules/main/line.html?rev=3a184e957d",bindings:{data:"<",unit:"<",chartTitle:"<"},controller:["$scope","$rootScope","$api","$interval","$timeout",function(t,e,a,o,i){var r=this;console.log(r.data),t.$watchCollection(function(){return r.data},function(){t.baseConfig={dataLoaded:!0},t.lineConfig=angular.copy(t.baseConfig),t.lineOption=r.data})}]});