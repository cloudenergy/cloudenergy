"use strict";angular.module("app").controller("monitorEdit",["$scope","$stateParams","$state","$api","SweetAlert",function(t,e,r,o,l){var u;t.submit=function(e){var n,s,i=angular.copy(t.sensor);i.building=t.sensor.building&&t.sensor.building.id,u?(i.energy=(n=u.id,s=n.split("|"),_.isArray(s)&&s[0]||n),i.energyPath=u.id):(i.energy="",i.energyPath=""),o.sensorchannel.update(i,function(){r.go("admin.sensor.info")},l.error)},o.sensorchannel.info({id:e.id},function(e){t.sensor=e.result[0],o.energy.info({project:t.sensor.project},function(e){var n,s=e.result.energy;t.viewOfEnergy=[{nodes:function n(s,e,i){if(!e)return;var t=[];_.each(e,function(e){e.childrens?e.ischild=!1:e.ischild=!0,e.parent=s,e.level=i,e.nodes=n(e,e.childrens,i+1),t.push(e)});t.sort(function(e,n){return e.title>n.title?1:-1});return t}(null,e.result.energy,1),title:"能耗分类",level:0}],t.sensor.energyPath&&_.each(t.sensor.energyPath.split("|"),function(e){s&&(n?n+="|"+e:n=e,(s=s[n])&&(s&&!s.childrens?(s.isSelect=!0,u=s):s=s.childrens))}),o.building.info({id:t.sensor.building},function(e){t.building=e.result,t.building&&(t.sensor.building=t.building)})},function(){t.viewOfEnergy=[{nodes:[],title:"能耗分类",level:0}]})}),t.onChoice=function(e){e.isSelect=!e.isSelect;var s=function(e,n){e&&e.nodes&&e.nodes.length&&(_.each(e.nodes,function(e){s(e,n),e.isSelect=n}),e.isSelect=n)};s(e,e.isSelect)},t.onEnergyChoice=function(e){e.nodes||(u&&(u.isSelect=!1),(u=e).isSelect=!0)},t.OnCollapsePayStatus=function(){t.sensor.paystatus&&"NONE"!=t.sensor.paystatus?t.sensor.paystatus="NONE":t.sensor.paystatus="BYSELF"},t.OnSelectPayMode=function(e,n){e.preventDefault(),t.sensor.paystatus=n}}]);