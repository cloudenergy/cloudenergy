angular.module("app").component("audit",{templateUrl:"app/modules/audit/audit.html?rev=aa1245b147",controller:["$api","$scope","$state","$q","$stateParams","SweetAlert","$rootScope","$uibModal",function(t,e,a,r,o,n,i,l){var s=this;function c(e){var t=new Date;t.setDate(t.getDate()+e);var a=t.getFullYear(),r=t.getMonth()+1,o=t.getDate();return String(a)+String(r<10&&"0"+r||r)+String(o<10&&"0"+o||o)}s.energyNum=0,s.lastMonth=String(0==(new Date).getMonth()?(new Date).getFullYear()-1:(new Date).getFullYear())+(0==(new Date).getMonth()?"12":1==String((new Date).getMonth()).length&&"0"+String((new Date).getMonth())||String((new Date).getMonth())),s.lastYearMonth=String((new Date).getFullYear())-1+((new Date).getMonth()+1<10&&"0"+((new Date).getMonth()+1)||(new Date).getMonth()+1),s.thisMonth=String((new Date).getFullYear())+((new Date).getMonth()+1<10&&"0"+((new Date).getMonth()+1)||(new Date).getMonth()+1),s.startDate=String(0==(new Date).getMonth()?(new Date).getFullYear()-1:(new Date).getFullYear())+(0==(new Date).getMonth()?"12":1==String((new Date).getMonth()).length&&"0"+String((new Date).getMonth())||String((new Date).getMonth()))+String((new Date).getDate()),s.endDate=c(0),s.date=c(0).split("")[0]+c(0).split("")[1]+c(0).split("")[2]+c(0).split("")[3]+"-"+c(0).split("")[4]+c(0).split("")[5]+"-"+c(0).split("")[6]+c(0).split("")[7],s.more=[{key:"ALL",title:"东一教学楼"},{key:"HOTWATERMETER",title:"东二教学楼"},{key:"TEMPERATURECONTROL",title:"西一教学楼"},{key:"TTYPETEMPCONTROL",title:" 西二教学楼"},{key:"DDWATERMETER",title:"宿舍"}],s.energytype=s.more[0].title,s.chooseenergytype=function(e){s.energytype=e.title},t.project.auditParameter({projectId:i.Project[0]._id,time:(new Date).getFullYear()},function(e){e=e.result,s.eleConsumptionPerArea=e.eleConsumptionPerArea,s.consumptionPerCapita=e.consumptionPerCapita,s.indicator=e.indicator,t.project.auditParameter({projectId:i.Project[0]._id,time:(new Date).getFullYear()-1},function(e){e=e.result,s.eleConsumptionPerAreaP=e.eleConsumptionPerArea&&(s.eleConsumptionPerArea-e.eleConsumptionPerArea)/s.eleConsumptionPerArea*100||100,s.consumptionPerCapitaP=e.consumptionPerCapita&&(s.consumptionPerCapita-e.consumptionPerCapita)/s.consumptionPerCapita*100||100},function(e){s.eleConsumptionPerAreaP=e.eleConsumptionPerArea&&(s.eleConsumptionPerArea-e.eleConsumptionPerArea)/s.eleConsumptionPerArea*100||100,s.consumptionPerCapitaP=e.consumptionPerCapita&&(s.consumptionPerCapita-e.consumptionPerCapita)/s.consumptionPerCapita*100||100})}),s.OnImport=function(){l.open({size:"sm",templateUrl:"import.html",controller:["$scope","$uibModalInstance","SweetAlert",function(e,t,a){e.actionURL="/api/import/auditParameter?",e.Character="54d032dd877012ac6d37063f",e.ProjectID=i.Project[0]._id,e.OnCancel=t.dismiss,e.OnUploadComplete=function(e){e.code?a.error(e.result,e.message):(a.success("导入成功"),t.close())}}],resolve:{ProjectID:function(){return i.Project[0]._id}}}).result.then(e.GetDepartment)},t.business.projectYearKGCE({projectid:i.Project[0]._id},function(e){e=e.result,s.energyNum=e.sum,s.area=e.area,s.energyArea=s.energyNum/s.area,s.monthly=e.monthly})}]}),angular.module("app").component("auditbar",{templateUrl:"app/modules/audit/auditbar.html?rev=77282b06ae",bindings:{data:"<",unit:"<",chartTitle:"<"},controller:["$scope","$rootScope","$api","$interval","$timeout",function(o,e,t,a,r){var n=this;o.$watchCollection(function(){return self.data},function(){var r=["#24CBE5","#FF9655","#6AF9C4","#64E572","#FFE556","#FF987B","#FF5690","#EB31AC","#EF76D0","#ECABF3","#9F7BF6","#8650EB","#90B2FF"];o.chartType="energy",o.baseConfig={dataLoaded:!0},o.barConfig=angular.copy(o.baseConfig),n.unactive=!0,n.custom=function(){t.eca.info({projectid:e.Project[0]._id,type:"CUSTOMER"},function(e){var t=e.result;n.categoryArray=[],angular.forEach(t,function(e){n.categoryArray.push(e.id)})}).$promise.then(function(){t.eca.analysis({nodes:n.categoryArray,projectid:e.Project[0]._id,timefrom:String((new Date).getFullYear()),timeto:String((new Date).getFullYear()),detail:!0,timetype:"YEAR"},function(t){var a;n.data=t.result,angular.forEach(n.data,function(e){e.kgcesum=e.data&&e.data.kgcesum||0}),n.data=n.data.sort((a="kgcesum",function(e,t){return e[a]-t[a]})),n.data=n.data.slice(-10),n.yname=[],n.series=[],angular.forEach(n.data,function(e){n.yname.push(e.title),n.series.push(e.data&&e.data.kgcesum||0)}),o.barOption={tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0,y:0,y2:0},xAxis:{type:"value",boundaryGap:[0,.01],axisLine:{lineStyle:{color:"rgba(0,0,0,0)"}}},yAxis:{type:"category",axisLabel:{interval:0},data:n.yname},textStyle:{color:"#000"},series:[{type:"bar",data:n.series}]},n.typeChange=function(e){"bar"==e?o.barOption={tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"value",boundaryGap:[0,.01],axisLine:{lineStyle:{color:"rgba(0,0,0,0)"}}},yAxis:{type:"category",data:n.yname},textStyle:{color:"#000"},series:[{type:"bar",data:n.series}]}:"pie"==e&&(n.legendData=[],n.selected={},n.seriesData=[],angular.forEach(n.data,function(e){n.legendData.push(e.title),n.selected[e.title]=!0,n.seriesData.push({name:e.title,value:e.kgcesum})}),o.barOption={tooltip:{trigger:"item",formatter:"{a} <br/>{b} : {c} ({d}%)"},legend:{type:"scroll",orient:"vertical",right:10,top:20,bottom:20,data:t.legendData,textStyle:{color:"#000"},selected:t.selected},series:[{type:"pie",radius:"55%",center:["40%","50%"],label:{show:!1},labelLine:{normal:{show:!1}},data:n.seriesData,itemStyle:{emphasis:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}},color:r}]})}})})},n.custom(),n.byitem=function(){t.eca.info({projectid:e.Project[0]._id,type:"BYITEM"},function(e){var t=e.result;n.categoryArray=[],angular.forEach(t,function(e){n.categoryArray.push(e.id)})}).$promise.then(function(){n.ele=function(){t.eca.analysis({nodes:n.categoryArray,projectid:e.Project[0]._id,devicetype:["ELECTRICITYMETER","MELECTRICITYMETER"],timefrom:String((new Date).getFullYear()),timeto:String((new Date).getFullYear()),detail:!0,timetype:"YEAR"},function(e){n.data=e.result,angular.forEach(n.data,function(e){e.kgcesum=e.data&&e.data.kgcesum||0}),n.legendData=[],n.selected={},n.seriesData=[],angular.forEach(n.data,function(e){n.legendData.push(e.title),n.selected[e.title]=!0,n.seriesData.push({name:e.title,value:e.kgcesum})}),console.log(n.seriesData),o.barOption={tooltip:{trigger:"item",formatter:"{a} <br/>{b} : {c} ({d}%)"},legend:{type:"scroll",orient:"vertical",right:10,top:20,bottom:20,data:e.legendData,textStyle:{color:"#000"},selected:e.selected},series:[{name:"",type:"pie",radius:"55%",center:["40%","50%"],data:n.seriesData,itemStyle:{emphasis:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}},color:r}]}})},n.ele(),n.water=function(){t.eca.analysis({nodes:n.categoryArray,projectid:e.Project[0]._id,devicetype:["COLDWATERMETER","HOTWATERMETER","ULTRACOLDWATERMETER"],timefrom:String((new Date).getFullYear()),timeto:String((new Date).getFullYear()),detail:!0,timetype:"YEAR"},function(e){n.data=e.result,angular.forEach(n.data,function(e){e.kgcesum=e.data&&e.data.kgcesum||0}),n.legendData=[],n.selected={},n.seriesData=[],angular.forEach(n.data,function(e){n.legendData.push(e.title),n.selected[e.title]=!0,n.seriesData.push({name:e.title,value:e.kgcesum})}),o.barOption={tooltip:{trigger:"item",formatter:"{a} <br/>{b} : {c} ({d}%)"},legend:{type:"scroll",orient:"vertical",right:10,top:20,bottom:20,data:e.legendData,textStyle:{color:"#000"},selected:e.selected},series:[{type:"pie",radius:"55%",center:["40%","50%"],data:n.seriesData,itemStyle:{emphasis:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}},color:r}]}})}})}})}]}),angular.module("app").component("auditline",{templateUrl:"app/modules/audit/auditline.html?rev=23f8431841",bindings:{data:"<",unit:"<",type:"<",chartTitle:"<"},controller:["$scope","$rootScope","$api","$interval","$timeout",function(t,e,a,r,o){var n=this;t.$watchCollection(function(){return n.data},function(){n.thisYear=(new Date).getFullYear(),n.lastYear=n.thisYear-1,n.beforeLastYear=n.thisYear-2,n.typeChange=function(e){e&&(n.type=e),t.lineOption={tooltip:{trigger:"axis",axisPointer:{type:"cross",label:{backgroundColor:"#6a7985"}}},legend:{data:["参照用量","本年用量"],textStyle:{color:"#000"}},toolbox:{feature:{saveAsImage:{}}},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:[{type:"category",boundaryGap:!1,data:["一月","二月","三月","四月","五月","六月"]}],yAxis:[{type:"value"}],textStyle:{color:"#000"},series:[{name:"参照用量",type:n.type||"line",stack:"line"==n.type?"总量":null,smooth:!0,symbol:"circle",symbolSize:5,sampling:"average",itemStyle:{normal:{color:"#d68262"}},areaStyle:{normal:{color:new echarts.graphic.LinearGradient(0,0,0,1.4,[{offset:0,color:"#d68262"},{offset:1,color:"rgba(0,0,0,0)"}])}},data:n.data},{name:"本年用量",type:n.type||"line",stack:"line"==n.type?"总量":null,smooth:!0,symbol:"circle",symbolSize:5,sampling:"average",itemStyle:{normal:{color:"#8ec6ad"}},areaStyle:{normal:{color:new echarts.graphic.LinearGradient(0,0,0,1.4,[{offset:0,color:"#8ec6ad"},{offset:1,color:"rgba(0,0,0,0)"}])}},data:n.series}]}},t.baseConfig={dataLoaded:!0},t.lineConfig=angular.copy(t.baseConfig),a.business.projectYearKGCE({projectid:e.Project[0]._id},function(e){n.series=e.monthly,t.lineOption={tooltip:{trigger:"axis",axisPointer:{type:"cross",label:{backgroundColor:"#6a7985"}}},legend:{data:["参照用量","本年用量"],textStyle:{color:"#000"}},toolbox:{feature:{saveAsImage:{}}},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:[{type:"category",boundaryGap:!1,data:["一月","二月","三月","四月","五月"]}],yAxis:[{type:"value"}],textStyle:{color:"#000"},series:[{name:"参照用量",type:n.type||"line",stack:"总量",areaStyle:{normal:{}},smooth:!0,symbol:"circle",symbolSize:5,sampling:"average",itemStyle:{normal:{color:"#d68262"}},areaStyle:{normal:{color:new echarts.graphic.LinearGradient(0,0,0,1.4,[{offset:0,color:"#d68262"},{offset:1,color:"rgba(0,0,0,0)"}])}},data:n.data},{name:"本年用量",type:n.type||"line",stack:"总量",areaStyle:{normal:{}},smooth:!0,symbol:"circle",symbolSize:5,sampling:"average",itemStyle:{normal:{color:"#8ec6ad"}},areaStyle:{normal:{color:new echarts.graphic.LinearGradient(0,0,0,1.4,[{offset:0,color:"#8ec6ad"},{offset:1,color:"rgba(0,0,0,0)"}])}},data:n.series}]}})})}]});